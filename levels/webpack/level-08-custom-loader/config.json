{
  "id": "webpack-custom-loader",
  "title": "ğŸ”§ è‡ªå®šä¹‰Loaderå¼€å‘ - æ·±å…¥Webpackå†…æ ¸",
  "description": "Loaderæ˜¯Webpackçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå®ƒä»¬å°†å„ç§æ–‡ä»¶è½¬æ¢ä¸ºJavaScriptæ¨¡å—ã€‚æƒ³è¦çœŸæ­£æŒæ¡Webpackï¼Œå°±å¿…é¡»ç†è§£Loaderçš„å·¥ä½œåŸç†ã€‚è¿™ä¸€å…³å°†å¸¦ä½ ä»é›¶å¼€å‘ä¸¤ä¸ªå®ç”¨çš„Loaderï¼šMarkdownè½¬HTMLçš„loaderå’Œæ·»åŠ æ–‡ä»¶å¤´æ³¨é‡Šçš„loaderã€‚",
  "difficulty": "é«˜çº§",
  "estimatedTime": "45åˆ†é’Ÿ",
  "category": "webpack",
  "scenario": "ä½ çš„é¡¹ç›®æœ‰ç‰¹æ®Šéœ€æ±‚ï¼šéœ€è¦ç›´æ¥å¯¼å…¥Markdownæ–‡ä»¶ä½œä¸ºHTMLï¼Œè¿˜éœ€è¦ä¸ºæ‰€æœ‰JSæ–‡ä»¶è‡ªåŠ¨æ·»åŠ ç‰ˆæƒä¿¡æ¯ã€‚ç°æœ‰çš„Loaderéƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œä½ éœ€è¦å¼€å‘è‡ªå®šä¹‰Loaderæ¥è§£å†³è¿™äº›é—®é¢˜ã€‚",
  "learningObjectives": [
    "ğŸ” æ·±å…¥ç†è§£Loaderçš„å·¥ä½œåŸç†å’Œç”Ÿå‘½å‘¨æœŸ",
    "ğŸ“ å¼€å‘Markdownè½¬HTMLçš„åŒæ­¥Loader",
    "ğŸ·ï¸ å¼€å‘æ·»åŠ æ–‡ä»¶å¤´æ³¨é‡Šçš„å¼‚æ­¥Loader",
    "âš™ï¸ æŒæ¡Loaderé€‰é¡¹é…ç½®å’ŒéªŒè¯æœºåˆ¶"
  ],
  "tasks": [
    {
      "id": "create-markdown-loader",
      "title": "ğŸ“ ä»»åŠ¡1ï¼šå¼€å‘Markdownè½¬HTMLçš„Loader",
      "description": "åˆ›å»ºä¸€ä¸ªåŒæ­¥Loaderï¼Œå°†Markdownæ–‡ä»¶è½¬æ¢ä¸ºHTMLå­—ç¬¦ä¸²ï¼Œè®©ä½ å¯ä»¥ç›´æ¥åœ¨JSä¸­å¯¼å…¥Markdownå†…å®¹ã€‚",
      "specificSteps": [
        {
          "step": 1,
          "action": "åˆ›å»ºloaders/markdown-loader.jsæ–‡ä»¶",
          "code": "const marked = require('marked');\nconst loaderUtils = require('loader-utils');\n\n// Markdown Loader - åŒæ­¥ç‰ˆæœ¬\nmodule.exports = function(source) {\n  // è·å–loaderé€‰é¡¹\n  const options = loaderUtils.getOptions(this) || {};\n  \n  // é…ç½®markedé€‰é¡¹\n  const markedOptions = {\n    gfm: true, // å¯ç”¨GitHubé£æ ¼Markdown\n    breaks: options.breaks || false,\n    sanitize: options.sanitize || false\n  };\n  \n  // è½¬æ¢Markdownä¸ºHTML\n  const html = marked(source, markedOptions);\n  \n  // è¿”å›JavaScriptæ¨¡å—ä»£ç \n  return `export default ${JSON.stringify(html)};`;\n};",
          "explanation": "è¿™ä¸ªLoaderå°†Markdownæºç è½¬æ¢ä¸ºHTMLï¼Œå¹¶åŒ…è£…æˆESæ¨¡å—"
        },
        {
          "step": 2,
          "action": "åœ¨webpack.config.jsä¸­é…ç½®Loader",
          "code": "module.exports = {\n  module: {\n    rules: [\n      {\n        test: /\\.md$/,\n        use: {\n          loader: './loaders/markdown-loader.js',\n          options: {\n            breaks: true,\n            sanitize: false\n          }\n        }\n      }\n    ]\n  }\n};",
          "explanation": "é…ç½®Webpackä½¿ç”¨è‡ªå®šä¹‰Loaderå¤„ç†.mdæ–‡ä»¶"
        }
      ],
      "loaderFeatures": {
        "åŒæ­¥å¤„ç†": "ç›´æ¥è¿”å›è½¬æ¢ç»“æœï¼Œé€‚åˆç®€å•çš„æ–‡ä»¶è½¬æ¢",
        "é€‰é¡¹æ”¯æŒ": "é€šè¿‡loader-utilsè·å–ç”¨æˆ·é…ç½®",
        "æ¨¡å—åŒ…è£…": "å°†è½¬æ¢ç»“æœåŒ…è£…æˆJavaScriptæ¨¡å—",
        "é”™è¯¯å¤„ç†": "å¯ä»¥æŠ›å‡ºå¼‚å¸¸æ¥æŠ¥å‘Šè½¬æ¢é”™è¯¯"
      },
      "expectedResult": "å¯ä»¥åœ¨JSä¸­import Markdownæ–‡ä»¶ï¼Œè·å¾—HTMLå­—ç¬¦ä¸²",
      "validation": {
        "type": "file-exists",
        "files": ["loaders/markdown-loader.js"]
      }
    },
    {
      "id": "create-banner-loader",
      "title": "ğŸ·ï¸ ä»»åŠ¡2ï¼šå¼€å‘æ–‡ä»¶å¤´æ³¨é‡ŠLoader",
      "description": "åˆ›å»ºä¸€ä¸ªå¼‚æ­¥Loaderï¼Œä¸ºJavaScriptæ–‡ä»¶è‡ªåŠ¨æ·»åŠ ç‰ˆæƒä¿¡æ¯æˆ–å…¶ä»–å¤´éƒ¨æ³¨é‡Šã€‚",
      "specificSteps": [
        {
          "step": 1,
          "action": "åˆ›å»ºloaders/banner-loader.jsæ–‡ä»¶",
          "code": "const loaderUtils = require('loader-utils');\nconst fs = require('fs');\nconst path = require('path');\n\n// Banner Loader - å¼‚æ­¥ç‰ˆæœ¬\nmodule.exports = function(source) {\n  // æ ‡è®°ä¸ºå¼‚æ­¥Loader\n  const callback = this.async();\n  \n  // è·å–é€‰é¡¹\n  const options = loaderUtils.getOptions(this) || {};\n  \n  // ç”Ÿæˆbannerå†…å®¹\n  const generateBanner = () => {\n    const now = new Date();\n    const banner = options.banner || `/**\\n * Generated by webpack\\n * Date: ${now.toISOString()}\\n * File: ${this.resourcePath}\\n */\\n\\n`;\n    \n    return banner;\n  };\n  \n  // å¦‚æœæœ‰banneræ–‡ä»¶ï¼Œå¼‚æ­¥è¯»å–\n  if (options.bannerFile) {\n    const bannerPath = path.resolve(this.context, options.bannerFile);\n    \n    fs.readFile(bannerPath, 'utf8', (err, bannerContent) => {\n      if (err) {\n        return callback(err);\n      }\n      \n      const result = bannerContent + '\\n\\n' + source;\n      callback(null, result);\n    });\n  } else {\n    // åŒæ­¥ç”Ÿæˆbanner\n    const banner = generateBanner();\n    const result = banner + source;\n    callback(null, result);\n  }\n};",
          "explanation": "å¼‚æ­¥Loaderä½¿ç”¨callbackæ¥è¿”å›ç»“æœï¼Œæ”¯æŒæ–‡ä»¶è¯»å–ç­‰å¼‚æ­¥æ“ä½œ"
        },
        {
          "step": 2,
          "action": "é…ç½®Banner Loader",
          "code": "{\n  test: /\\.js$/,\n  exclude: /node_modules/,\n  use: [\n    {\n      loader: './loaders/banner-loader.js',\n      options: {\n        banner: '/* Copyright 2024 My Company */\\n',\n        // bannerFile: './banner.txt' // å¯é€‰ï¼šä»æ–‡ä»¶è¯»å–banner\n      }\n    },\n    'babel-loader' // banner-loaderåœ¨babel-loaderä¹‹å‰æ‰§è¡Œ\n  ]\n}",
          "explanation": "Banner Loaderé€šå¸¸æ”¾åœ¨å…¶ä»–Loaderä¹‹å‰ï¼Œä¸ºæºæ–‡ä»¶æ·»åŠ å¤´éƒ¨ä¿¡æ¯"
        }
      ],
      "asyncLoaderFeatures": {
        "å¼‚æ­¥å¤„ç†": "ä½¿ç”¨this.async()è·å–callbackå‡½æ•°",
        "é”™è¯¯å¤„ç†": "é€šè¿‡callback(error)æŠ¥å‘Šé”™è¯¯",
        "æ–‡ä»¶è¯»å–": "å¯ä»¥è¯»å–å¤–éƒ¨æ–‡ä»¶ä½œä¸ºbannerå†…å®¹",
        "ä¸Šä¸‹æ–‡ä¿¡æ¯": "å¯ä»¥è®¿é—®this.resourcePathç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯"
      },
      "expectedResult": "æ‰€æœ‰JSæ–‡ä»¶éƒ½ä¼šè‡ªåŠ¨æ·»åŠ æŒ‡å®šçš„å¤´éƒ¨æ³¨é‡Š",
      "validation": {
        "type": "file-exists",
        "files": ["loaders/banner-loader.js"]
      }
    },
    {
      "id": "test-custom-loaders",
      "title": "ğŸ§ª ä»»åŠ¡3ï¼šæµ‹è¯•è‡ªå®šä¹‰Loader",
      "description": "åˆ›å»ºæµ‹è¯•æ–‡ä»¶æ¥éªŒè¯è‡ªå®šä¹‰Loaderçš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚",
      "specificSteps": [
        {
          "step": 1,
          "action": "åˆ›å»ºæµ‹è¯•ç”¨çš„Markdownæ–‡ä»¶",
          "code": "// src/content.md\n# æ¬¢è¿ä½¿ç”¨è‡ªå®šä¹‰Loader\n\nè¿™æ˜¯ä¸€ä¸ª**Markdown**æ–‡ä»¶ï¼Œå°†è¢«æˆ‘ä»¬çš„è‡ªå®šä¹‰Loaderè½¬æ¢ä¸ºHTMLã€‚\n\n## åŠŸèƒ½ç‰¹æ€§\n\n- âœ… æ”¯æŒGitHubé£æ ¼Markdown\n- âœ… å¯é…ç½®é€‰é¡¹\n- âœ… é”™è¯¯å¤„ç†\n\n```javascript\n// ç¤ºä¾‹ä»£ç \nconst html = require('./content.md');\nconsole.log(html);\n```",
          "explanation": "è¿™ä¸ªMarkdownæ–‡ä»¶å°†ç”¨æ¥æµ‹è¯•markdown-loader"
        },
        {
          "step": 2,
          "action": "åœ¨ä¸»æ–‡ä»¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰Loader",
          "code": "// src/index.js\nimport markdownContent from './content.md';\n\n// ä½¿ç”¨è½¬æ¢åçš„HTMLå†…å®¹\ndocument.getElementById('content').innerHTML = markdownContent;\n\nconsole.log('Markdownè½¬æ¢ç»“æœ:', markdownContent);",
          "explanation": "ç›´æ¥å¯¼å…¥Markdownæ–‡ä»¶ï¼Œè·å¾—è½¬æ¢åçš„HTML"
        }
      ],
      "testingBenefits": {
        "åŠŸèƒ½éªŒè¯": "ç¡®ä¿LoaderæŒ‰é¢„æœŸå·¥ä½œ",
        "é€‰é¡¹æµ‹è¯•": "éªŒè¯ä¸åŒé€‰é¡¹çš„æ•ˆæœ",
        "é”™è¯¯å¤„ç†": "æµ‹è¯•å¼‚å¸¸æƒ…å†µçš„å¤„ç†",
        "æ€§èƒ½è¯„ä¼°": "æ£€æŸ¥Loaderçš„æ€§èƒ½å½±å“"
      },
      "expectedResult": "æ„å»ºæˆåŠŸï¼ŒMarkdownå†…å®¹æ­£ç¡®è½¬æ¢ä¸ºHTMLå¹¶æ˜¾ç¤º",
      "validation": {
        "type": "build-success",
        "command": "npm run build"
      }
    },
    {
      "id": "add-loader-options-validation",
      "title": "âœ… ä»»åŠ¡4ï¼šæ·»åŠ é€‰é¡¹éªŒè¯",
      "description": "ä½¿ç”¨schema-utilsä¸ºLoaderæ·»åŠ é€‰é¡¹éªŒè¯ï¼Œæä¾›æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚",
      "specificSteps": [
        {
          "step": 1,
          "action": "ä¸ºmarkdown-loaderæ·»åŠ é€‰é¡¹éªŒè¯",
          "code": "const marked = require('marked');\nconst loaderUtils = require('loader-utils');\nconst { validate } = require('schema-utils');\n\n// é€‰é¡¹éªŒè¯schema\nconst schema = {\n  type: 'object',\n  properties: {\n    breaks: {\n      type: 'boolean',\n      description: 'æ˜¯å¦å°†æ¢è¡Œç¬¦è½¬æ¢ä¸º<br>æ ‡ç­¾'\n    },\n    sanitize: {\n      type: 'boolean',\n      description: 'æ˜¯å¦æ¸…ç†HTMLæ ‡ç­¾'\n    }\n  },\n  additionalProperties: false\n};\n\nmodule.exports = function(source) {\n  const options = loaderUtils.getOptions(this) || {};\n  \n  // éªŒè¯é€‰é¡¹\n  validate(schema, options, {\n    name: 'Markdown Loader',\n    baseDataPath: 'options'\n  });\n  \n  // ... å…¶ä½™ä»£ç ä¿æŒä¸å˜\n};",
          "explanation": "æ·»åŠ é€‰é¡¹éªŒè¯å¯ä»¥åœ¨é…ç½®é”™è¯¯æ—¶æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯"
        }
      ],
      "validationBenefits": {
        "ç±»å‹æ£€æŸ¥": "ç¡®ä¿é€‰é¡¹ç±»å‹æ­£ç¡®",
        "é”™è¯¯æç¤º": "æä¾›æ¸…æ™°çš„é…ç½®é”™è¯¯ä¿¡æ¯",
        "æ–‡æ¡£åŒ–": "schemaæœ¬èº«å°±æ˜¯é€‰é¡¹çš„æ–‡æ¡£",
        "IDEæ”¯æŒ": "æ”¯æŒIDEçš„è‡ªåŠ¨è¡¥å…¨å’Œæç¤º"
      },
      "expectedResult": "é…ç½®é”™è¯¯æ—¶ä¼šæ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯",
      "validation": {
        "type": "file-content",
        "file": "loaders/markdown-loader.js",
        "contains": "schema-utils"
      }
    }
  ],
  "progressiveHints": [
    {
      "attempt": 1,
      "hint": "ğŸ”§ **ç¬¬ä¸€ä¸ªæç¤º**ï¼šLoaderå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶æºç ï¼Œè¿”å›è½¬æ¢åçš„ä»£ç ï¼š\n\n```javascript\n// loaders/markdown-loader.js\nmodule.exports = function(source) {\n  // è½¬æ¢é€»è¾‘\n  const result = transform(source);\n  return `export default ${JSON.stringify(result)};`;\n};\n```"
    },
    {
      "attempt": 2,
      "hint": "ğŸ“ **ç¬¬äºŒä¸ªæç¤º**ï¼šä½¿ç”¨markedåº“è½¬æ¢Markdownï¼š\n\n```javascript\nconst marked = require('marked');\nconst loaderUtils = require('loader-utils');\n\nmodule.exports = function(source) {\n  const options = loaderUtils.getOptions(this) || {};\n  const html = marked(source, options);\n  return `export default ${JSON.stringify(html)};`;\n};\n```"
    },
    {
      "attempt": 3,
      "hint": "ğŸ¯ **å®Œæ•´çš„Loaderå¼€å‘æ¨¡æ¿**ï¼š\n\n```javascript\n// åŒæ­¥Loader\nconst marked = require('marked');\nconst loaderUtils = require('loader-utils');\n\nmodule.exports = function(source) {\n  const options = loaderUtils.getOptions(this) || {};\n  const html = marked(source, { gfm: true, ...options });\n  return `export default ${JSON.stringify(html)};`;\n};\n\n// å¼‚æ­¥Loader\nmodule.exports = function(source) {\n  const callback = this.async();\n  const options = loaderUtils.getOptions(this) || {};\n  \n  // å¼‚æ­¥å¤„ç†\n  setTimeout(() => {\n    const result = processSource(source, options);\n    callback(null, result);\n  }, 0);\n};\n```"
    }
  ],
  "solution": {
    "loaders/markdown-loader.js": "const marked = require('marked');\nconst loaderUtils = require('loader-utils');\nconst { validate } = require('schema-utils');\n\n// é€‰é¡¹éªŒè¯schema\nconst schema = {\n  type: 'object',\n  properties: {\n    breaks: {\n      type: 'boolean',\n      description: 'æ˜¯å¦å°†æ¢è¡Œç¬¦è½¬æ¢ä¸º<br>æ ‡ç­¾'\n    },\n    sanitize: {\n      type: 'boolean', \n      description: 'æ˜¯å¦æ¸…ç†HTMLæ ‡ç­¾'\n    },\n    gfm: {\n      type: 'boolean',\n      description: 'æ˜¯å¦å¯ç”¨GitHubé£æ ¼Markdown'\n    }\n  },\n  additionalProperties: false\n};\n\n/**\n * Markdown Loader - å°†Markdownæ–‡ä»¶è½¬æ¢ä¸ºHTMLå­—ç¬¦ä¸²\n * @param {string} source - Markdownæºç \n * @returns {string} - JavaScriptæ¨¡å—ä»£ç \n */\nmodule.exports = function(source) {\n  // è·å–loaderé€‰é¡¹\n  const options = loaderUtils.getOptions(this) || {};\n  \n  // éªŒè¯é€‰é¡¹\n  validate(schema, options, {\n    name: 'Markdown Loader',\n    baseDataPath: 'options'\n  });\n  \n  // é…ç½®markedé€‰é¡¹\n  const markedOptions = {\n    gfm: options.gfm !== false, // é»˜è®¤å¯ç”¨GitHubé£æ ¼\n    breaks: options.breaks || false,\n    sanitize: options.sanitize || false,\n    highlight: function(code, lang) {\n      // å¯ä»¥é›†æˆä»£ç é«˜äº®åº“\n      return code;\n    }\n  };\n  \n  try {\n    // è½¬æ¢Markdownä¸ºHTML\n    const html = marked(source, markedOptions);\n    \n    // è¿”å›JavaScriptæ¨¡å—ä»£ç \n    return `export default ${JSON.stringify(html)};`;\n  } catch (error) {\n    // æŠ›å‡ºè½¬æ¢é”™è¯¯\n    this.emitError(new Error(`Markdownè½¬æ¢å¤±è´¥: ${error.message}`));\n    return `export default '';`;\n  }\n};",
    "loaders/banner-loader.js": "const loaderUtils = require('loader-utils');\nconst fs = require('fs');\nconst path = require('path');\n\n/**\n * Banner Loader - ä¸ºæ–‡ä»¶æ·»åŠ å¤´éƒ¨æ³¨é‡Š\n * @param {string} source - æºæ–‡ä»¶å†…å®¹\n */\nmodule.exports = function(source) {\n  // æ ‡è®°ä¸ºå¼‚æ­¥Loader\n  const callback = this.async();\n  \n  // è·å–é€‰é¡¹\n  const options = loaderUtils.getOptions(this) || {};\n  \n  // ç”Ÿæˆé»˜è®¤banner\n  const generateDefaultBanner = () => {\n    const now = new Date();\n    const fileName = path.basename(this.resourcePath);\n    \n    return `/**\n * File: ${fileName}\n * Generated: ${now.toISOString()}\n * Build: ${process.env.NODE_ENV || 'development'}\n */\n\n`;\n  };\n  \n  // å¦‚æœæŒ‡å®šäº†banneræ–‡ä»¶ï¼Œå¼‚æ­¥è¯»å–\n  if (options.bannerFile) {\n    const bannerPath = path.resolve(this.context, options.bannerFile);\n    \n    // æ·»åŠ æ–‡ä»¶ä¾èµ–ï¼Œæ–‡ä»¶å˜åŒ–æ—¶é‡æ–°æ„å»º\n    this.addDependency(bannerPath);\n    \n    fs.readFile(bannerPath, 'utf8', (err, bannerContent) => {\n      if (err) {\n        this.emitWarning(new Error(`æ— æ³•è¯»å–banneræ–‡ä»¶: ${bannerPath}`));\n        const defaultBanner = generateDefaultBanner();\n        return callback(null, defaultBanner + source);\n      }\n      \n      const result = bannerContent + '\\n\\n' + source;\n      callback(null, result);\n    });\n  } else {\n    // ä½¿ç”¨é€‰é¡¹ä¸­çš„banneræˆ–é»˜è®¤banner\n    const banner = options.banner || generateDefaultBanner();\n    const result = banner + source;\n    callback(null, result);\n  }\n};\n\n// æ ‡è®°ä¸ºraw loaderï¼ˆå¦‚æœéœ€è¦å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰\n// module.exports.raw = true;",
    "webpack.config.js": "const path = require('path');\nconst HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = {\n  entry: './src/index.js',\n  output: {\n    path: path.resolve(__dirname, 'dist'),\n    filename: '[name].[contenthash].js',\n    clean: true\n  },\n  mode: 'development',\n  devtool: 'source-map',\n  \n  module: {\n    rules: [\n      // Markdownæ–‡ä»¶å¤„ç†\n      {\n        test: /\\.md$/,\n        use: {\n          loader: './loaders/markdown-loader.js',\n          options: {\n            breaks: true,\n            gfm: true,\n            sanitize: false\n          }\n        }\n      },\n      // JavaScriptæ–‡ä»¶å¤„ç†ï¼ˆæ·»åŠ bannerï¼‰\n      {\n        test: /\\.js$/,\n        exclude: /node_modules/,\n        use: [\n          {\n            loader: './loaders/banner-loader.js',\n            options: {\n              banner: '/* Copyright 2024 My Company. All rights reserved. */\\n'\n              // bannerFile: './banner.txt' // å¯é€‰ï¼šä»æ–‡ä»¶è¯»å–\n            }\n          }\n        ]\n      }\n    ]\n  },\n  \n  plugins: [\n    new HtmlWebpackPlugin({\n      template: './src/index.html',\n      title: 'è‡ªå®šä¹‰Loaderç¤ºä¾‹'\n    })\n  ]\n};"
  },
  "resources": [
    {
      "title": "ç¼–å†™ Loader",
      "url": "https://webpack.js.org/contribute/writing-a-loader/"
    },
    {
      "title": "Loader API",
      "url": "https://webpack.js.org/api/loaders/"
    }
  ]
}